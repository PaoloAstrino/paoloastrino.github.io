<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React-like DecryptedText Test</title>
    <style>
        body {
            font-family: "Poppins", sans-serif;
            background: #0a0a0a;
            color: white;
            padding: 2rem;
            line-height: 1.6;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 3rem 0;
            padding: 2rem;
            border: 1px solid #333;
            border-radius: 8px;
        }
        .test-text {
            font-size: 1.5rem;
            margin: 1rem 0;
            padding: 1rem;
            background: #111;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .test-text:hover {
            background: #222;
        }
        h2 {
            color: #4f46e5;
            margin-bottom: 1rem;
        }
        p {
            color: #888;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>React-like DecryptedText Animation Test</h1>
        
        <div class="test-section">
            <h2>Example 1: Defaults (hover to decrypt)</h2>
            <p>Should match: &lt;DecryptedText text="Hover me!" /&gt;</p>
            <div class="test-text hover-default">Hover me!</div>
        </div>
        
        <div class="test-section">
            <h2>Example 2: Customized speed and characters</h2>
            <p>Should match React component with speed={100}, maxIterations={20}, characters="ABCD1234!?"</p>
            <div class="test-text hover-custom">Customize me</div>
        </div>
        
        <div class="test-section">
            <h2>Example 3: Animate on view (center reveal)</h2>
            <p>Should match React component with animateOn="view", revealDirection="center"</p>
            <div class="test-text view-center">This text animates when in view</div>
        </div>
    </div>

    <script>
        // React-like DecryptedText implementation
        function DecryptedText(element, options = {}) {
            // React component defaults - matching exactly
            const defaults = {
                text: element.textContent.trim(),
                speed: 50,                    // Default speed from React component
                maxIterations: 6,             // Default iterations from React component  
                characters: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+-=[]{}|;:,.<>?~`",
                className: "revealed",
                parentClassName: "all-letters", 
                encryptedClassName: "encrypted",
                animateOn: "hover",           // Default trigger
                revealDirection: "left",      // Default reveal direction
                revealDelay: 30,              // Delay between revealing each character
                threshold: 0.1,
                rootMargin: "0px",
                delay: 0,
                onComplete: null,
                onStart: null,
            };

            const config = { ...defaults, ...options };
            const originalText = config.text;
            let isAnimating = false;
            let hasAnimated = false;

            // Simple character randomizer
            function getRandomChar() {
                return config.characters[Math.floor(Math.random() * config.characters.length)];
            }

            // Main animation function - simplified to match React behavior
            function animate() {
                if (isAnimating) return;
                isAnimating = true;

                if (config.onStart) config.onStart(element);

                // Add CSS classes
                element.classList.add(config.encryptedClassName);
                if (config.parentClassName && element.parentElement) {
                    element.parentElement.classList.add(config.parentClassName);
                }

                const textArray = originalText.split("");
                let workingArray = textArray.map(() => getRandomChar());
                
                // For center reveal
                let revealOrder = [];
                if (config.revealDirection === "center") {
                    const center = Math.floor(textArray.length / 2);
                    revealOrder = [center];
                    for (let i = 1; i <= center; i++) {
                        if (center - i >= 0) revealOrder.push(center - i);
                        if (center + i < textArray.length) revealOrder.push(center + i);
                    }
                } else {
                    // Left to right (default)
                    revealOrder = textArray.map((_, i) => i);
                }

                let revealedCount = 0;

                // Start with scrambled text
                element.textContent = workingArray.join("");

                // Reveal characters one by one
                revealOrder.forEach((charIndex, orderIndex) => {
                    const char = textArray[charIndex];
                    let iterationCount = 0;

                    setTimeout(() => {
                        const charInterval = setInterval(() => {
                            if (char === " ") {
                                workingArray[charIndex] = " ";
                                clearInterval(charInterval);
                                revealedCount++;
                                checkComplete();
                                return;
                            }

                            if (iterationCount < config.maxIterations) {
                                workingArray[charIndex] = getRandomChar();
                                iterationCount++;
                            } else {
                                workingArray[charIndex] = char;
                                clearInterval(charInterval);
                                revealedCount++;
                                checkComplete();
                            }

                            element.textContent = workingArray.join("");
                        }, config.speed);
                    }, orderIndex * config.revealDelay);
                });

                function checkComplete() {
                    if (revealedCount === textArray.length) {
                        element.classList.remove(config.encryptedClassName);
                        element.classList.add(config.className);
                        if (config.parentClassName && element.parentElement) {
                            element.parentElement.classList.remove(config.parentClassName);
                        }
                        isAnimating = false;
                        hasAnimated = true;
                        if (config.onComplete) config.onComplete(element);
                    }
                }
            }

            // Reset function
            function reset() {
                hasAnimated = false;
                isAnimating = false;
                element.classList.remove(config.className, config.encryptedClassName);
                if (config.parentClassName && element.parentElement) {
                    element.parentElement.classList.remove(config.parentClassName);
                }
                element.textContent = originalText;
            }

            // Setup triggers
            if (config.animateOn === "hover") {
                element.addEventListener("mouseenter", animate);
                element.addEventListener("mouseleave", reset);
            } else if (config.animateOn === "view") {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting && !hasAnimated) {
                            animate();
                            observer.unobserve(element);
                        }
                    });
                }, { threshold: config.threshold, rootMargin: config.rootMargin });
                observer.observe(element);
            }

            return { animate, reset, element, config };
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Example 1: Default settings (React component defaults)
            DecryptedText(document.querySelector('.hover-default'));

            // Example 2: Custom settings matching React props
            DecryptedText(document.querySelector('.hover-custom'), {
                speed: 100,
                maxIterations: 20,
                characters: "ABCD1234!?"
            });

            // Example 3: View trigger with center reveal
            DecryptedText(document.querySelector('.view-center'), {
                animateOn: "view",
                revealDirection: "center"
            });
        });
    </script>
</body>
</html>
